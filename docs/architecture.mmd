flowchart TD
    classDef device      fill:#1e1e2e,stroke:#89b4fa,color:#cdd6f4
    classDef fx          fill:#313244,stroke:#cba6f7,color:#cdd6f4
    classDef output      fill:#313244,stroke:#f38ba8,color:#cdd6f4
    classDef destination fill:#1e1e2e,stroke:#fab387,color:#cdd6f4
    classDef script      fill:#313244,stroke:#a6e3a1,color:#cdd6f4
    classDef daemon      fill:#313244,stroke:#89dceb,color:#cdd6f4
    classDef extension   fill:#313244,stroke:#f5c2e7,color:#cdd6f4

    subgraph REAPER ["ðŸŽ¬ REAPER"]
        direction TB

        subgraph TRACK ["ðŸŽžï¸ ReaTC Track"]
            direction TB

            subgraph SOURCES ["Sources"]
                direction LR
                LTC_AUDIO(["ðŸŽµ LTC Audio In"]):::device
                MTC_MIDI(["ðŸŽ¹ MTC MIDI In"]):::device
                TIMELINE(["â±ï¸ Timeline"]):::device
            end

            subgraph JSFX ["ReaTC Timecode Converter Â· JSFX"]
                direction TB
                DECODE["Decode & Priority"]:::fx
                ENCODE["Outputs"]:::fx
                DECODE --> ENCODE
            end

            SOURCES --> DECODE
        end

        subgraph LUA ["âš™ï¸ ReaTC Lua Script"]
            direction TB
            GMEM_READ["gmem read"]:::script
            UI["ðŸ–¥ï¸ UI Â· ReaImGui"]:::script
            GMEM_READ --> UI

            subgraph DAEMONS ["Python Daemons Â· stdin"]
                direction LR
                ARTNET_PY["reatc_artnet.py"]:::daemon
                OSC_PY["reatc_osc.py"]:::daemon
            end

            GMEM_READ --> DAEMONS
        end

        CPP_EXT["ðŸ”Œ C++ Extension\nreaper_reatc"]:::extension
        CPP_EXT -- "ExtState\nReaTC_CMD" --> LUA
        LUA -- "ExtState\nReaTC_STATE" --> CPP_EXT

        subgraph BAKE ["Standalone Scripts"]
            direction LR
            REGIONS_LUA["reatc_regions_to_ltc.lua"]:::script
            LTCGEN_PY["reatc_ltcgen.py"]:::daemon
            REGIONS_LUA -- "subprocess" --> LTCGEN_PY
        end

        ENCODE -- "gmem" --> GMEM_READ
        ENCODE -- "LTC Audio" --> PHY_OUT(["ðŸ”Œ Audio Output"]):::output
        ENCODE -- "MTC Quarter-Frame" --> MIDI_OUT(["ðŸŽ¹ MIDI Output"]):::output
    end

    subgraph DESTINATIONS ["ðŸ“¡ Timecode Destinations"]
        direction LR
        subgraph CONSOLE ["Lighting Console"]
            style CONSOLE stroke:#ffeb3b,stroke-width:2px,fill:#1a1a00
            ARTNET_IN(["Art-Net In"]):::destination
            LTC_IN(["LTC Audio In"]):::destination
            OSC_IN(["OSC In"]):::destination
        end
        subgraph MTC_DEST ["MTC Device"]
            style MTC_DEST stroke:#66bb6a,stroke-width:2px,fill:#001a00
            MTC_IN(["MTC In"]):::destination
        end
    end

    ARTNET_PY -- "UDP 6454" --> ARTNET_IN
    OSC_PY -- "UDP" --> OSC_IN
    PHY_OUT --> LTC_IN
    MIDI_OUT --> MTC_IN
    LTCGEN_PY -- "WAV file" --> LTC_IN
